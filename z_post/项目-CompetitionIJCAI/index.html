<!DOCTYPE html>













<html class="theme-next gemini" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">

<meta name="google-site-verification" content="jgw73iXouBAJcOuff0yi9vdSNDecBSOUXacsHJszpmo" />
<meta name="baidu-site-verification" content="xyf9WD2vvl" />











<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/apple-icon-57x57.png?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_body":"slideDownIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="赛题介绍及获得名次大赛地址: https://tianchi.aliyun.com/markets/tianchi/ijcai19_en天池地址: https://tianchi.aliyun.com/competition/entrance/231701/introduction队伍名称: 草帽小子海贼团线上成绩:  non-targeted attack track: 3 / 2519 tar">
<meta name="keywords" content="计算机视觉">
<meta property="og:type" content="article">
<meta property="og:title" content="【置顶】IJCAI 参赛方案分享">
<meta property="og:url" content="https://hellozhaozheng.github.io/z_post/项目-CompetitionIJCAI/index.html">
<meta property="og:site_name" content="从零开始的BLOG">
<meta property="og:description" content="赛题介绍及获得名次大赛地址: https://tianchi.aliyun.com/markets/tianchi/ijcai19_en天池地址: https://tianchi.aliyun.com/competition/entrance/231701/introduction队伍名称: 草帽小子海贼团线上成绩:  non-targeted attack track: 3 / 2519 tar">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://zerozone-blog.oss-cn-beijing.aliyuncs.com/CompetitionIJCAI/attack_tab1.jpg?x-oss-process=style/blog_img">
<meta property="og:image" content="http://zerozone-blog.oss-cn-beijing.aliyuncs.com/CompetitionIJCAI/attack_fig1.jpg?x-oss-process=style/blog_img">
<meta property="og:image" content="http://zerozone-blog.oss-cn-beijing.aliyuncs.com/CompetitionIJCAI/attack_fig2.jpg?x-oss-process=style/blog_img">
<meta property="og:image" content="http://zerozone-blog.oss-cn-beijing.aliyuncs.com/CompetitionIJCAI/fig1.jpg?x-oss-process=style/blog_img">
<meta property="og:image" content="http://zerozone-blog.oss-cn-beijing.aliyuncs.com/CompetitionIJCAI/fig2.jpg?x-oss-process=style/blog_img">
<meta property="og:image" content="http://zerozone-blog.oss-cn-beijing.aliyuncs.com/CompetitionIJCAI/fig3.jpg?x-oss-process=style/blog_img">
<meta property="og:image" content="http://zerozone-blog.oss-cn-beijing.aliyuncs.com/CompetitionIJCAI/tab1.jpg?x-oss-process=style/blog_img">
<meta property="og:image" content="http://zerozone-blog.oss-cn-beijing.aliyuncs.com/CompetitionIJCAI/tab2.jpg?x-oss-process=style/blog_img">
<meta property="og:updated_time" content="2019-07-25T13:12:42.212Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="【置顶】IJCAI 参赛方案分享">
<meta name="twitter:description" content="赛题介绍及获得名次大赛地址: https://tianchi.aliyun.com/markets/tianchi/ijcai19_en天池地址: https://tianchi.aliyun.com/competition/entrance/231701/introduction队伍名称: 草帽小子海贼团线上成绩:  non-targeted attack track: 3 / 2519 tar">
<meta name="twitter:image" content="http://zerozone-blog.oss-cn-beijing.aliyuncs.com/CompetitionIJCAI/attack_tab1.jpg?x-oss-process=style/blog_img">






  <link rel="canonical" href="https://hellozhaozheng.github.io/z_post/项目-CompetitionIJCAI/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>【置顶】IJCAI 参赛方案分享 | 从零开始的BLOG</title>
  






  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?21a4899cc63d3c11a3d90ac58074a19c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">从零开始的BLOG</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">与其感慨路难行，不如马上出发</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档<span class="badge">268</span></a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-计算机视觉">
    <a href="/categories/计算机视觉/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tripadvisor"></i> <br />计算机视觉</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-深度学习">
    <a href="/categories/深度学习/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-drupal"></i> <br />深度学习</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-caffe2">
    <a href="/categories/Caffe2/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-coffee"></i> <br />Caffe2</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-pytorch">
    <a href="/categories/PyTorch/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-free-code-camp"></i> <br />PyTorch</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-c++">
    <a href="/categories/Cpp/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-codiepie"></i> <br />C++</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-python">
    <a href="/categories/Python/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-product-hunt"></i> <br />Python</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-项目">
    <a href="/categories/项目/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-connectdevelop"></i> <br />项目</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-cuda">
    <a href="/categories/CUDA/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-braille"></i> <br />CUDA</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-其他">
    <a href="/categories/其他/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />其他</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签<span class="badge">41</span></a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于我</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />站内搜索(首次加载需3~5秒)</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="站内搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    
  
  
  
    
      
    
    <a href="https://github.com/hellozhaozheng" class="github-corner" target="_blank" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#222; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg>
    
      </a>
    



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hellozhaozheng.github.io/z_post/项目-CompetitionIJCAI/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZeroZone">
      <meta itemprop="description" content="吾乃闪耀的芝士蛋挞!">
      <meta itemprop="image" content="/images/avatar_zz.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="从零开始的BLOG">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">【置顶】IJCAI 参赛方案分享
              
            
          </h1>
        

        <div class="post-meta">
	
	     <i class="fa fa-thumb-tack"></i>
	    <font style="color:#999">置顶</font>
	    <span class="post-meta-divider">|</span>
	
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-15 17:01:48" itemprop="dateCreated datePublished" datetime="2019-07-15T17:01:48+08:00">2019-07-15</time>
            

            
          </span>

	  
  	    <span class="post-updated">
    		&nbsp; | &nbsp; 更新于
    		<time itemprop="dateUpdated" datetime="2019-07-25T21:12:42+08:00" content="2019-07-25">
      		  2019-07-25
    		</time>
  	  </span>
	  

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/项目/" itemprop="url" rel="index"><span itemprop="name">项目</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon"
            >
            <i class="fa fa-eye"></i>
             阅读次数： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">15k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">14 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="赛题介绍及获得名次"><a href="#赛题介绍及获得名次" class="headerlink" title="赛题介绍及获得名次"></a>赛题介绍及获得名次</h1><p><strong>大赛地址:</strong> <a href="https://tianchi.aliyun.com/markets/tianchi/ijcai19_en" target="_blank" rel="noopener">https://tianchi.aliyun.com/markets/tianchi/ijcai19_en</a><br><strong>天池地址:</strong> <a href="https://tianchi.aliyun.com/competition/entrance/231701/introduction" target="_blank" rel="noopener">https://tianchi.aliyun.com/competition/entrance/231701/introduction</a><br><strong>队伍名称:</strong> 草帽小子海贼团<br><strong>线上成绩:</strong></p>
<ul>
<li>non-targeted attack track: 3 / 2519</li>
<li>targeted attack tack: 8 / 2519</li>
<li>defense track: 9 / 2519</li>
</ul>
<p>近年来深度学习技术的不断突破，极大促进了人工智能行业的发展，而人工智能模型本身的安全问题，也日益受到AI从业人员的关注。2014年Christian Szegedy等人首次提出针对图像的对抗样本这一概念，并用实验结果展示了深度学习模型在安全方面的局限性。我们可以通过对原始样本有针对性的加入微小扰动来构造对抗样本，该扰动不易被人眼所察觉，但会导致AI模型识别错误，这种攻击被称为“对抗攻击“。该成果引发了学术界和工业界的广泛关注，成为目前深度学习领域最热的研究课题之一，新的对抗攻击方法不断涌现，应用课题从图像分类扩展到目标检测。对抗攻击技术也引发了业界对于AI模型安全的担忧，研究人员开展了针对对抗攻击的防御技术研究，也提出了若干种提升模型安全性能的方法，但迄今为止仍然无法完全防御来自对抗样本的攻击。</p>
<p>IJCAI-19 阿里巴巴人工智能对抗算法竞赛的目的是对AI模型的安全性进行探索。这个比赛主要针对图像分类任务，包括模型攻击与模型防御。参赛选手既可以作为攻击方，对图片进行轻微扰动生成对抗样本，使模型识别错误；也可以作为防御方，通过构建一个更加鲁棒的模型，准确识别对抗样本。</p>
<p>本次比赛，首次采用电商场景的图片识别任务进行攻防对抗。总共会公开110,000左右的商品图片，来自110个商品类目，每个类目大概1000个图片。选手可以使用这些数据训练更加鲁棒的识别模型或者生成更具攻击性的样本。</p>
<h1 id="任务目标及评测标准"><a href="#任务目标及评测标准" class="headerlink" title="任务目标及评测标准"></a>任务目标及评测标准</h1><p>本次比赛包括以下三个任务：</p>
<ul>
<li>无目标攻击: 生成对抗样本，使模型识别错误。</li>
<li>目标攻击: 生成对抗样本，使模型识别到指定的错误类别。</li>
<li>模型防御: 构建能够正确识别对抗样本的模型。</li>
</ul>
<p>三个赛道的评分独立计算, 计算方式分别为:</p>
<ol>
<li>无目标攻击:<ul>
<li>无目标攻击是不指定具体类目，只要让模型识别错误即可，同时扰动越小越好。</li>
<li>评估方法:<br>对每个生成的对抗样本，会采用 5 个基础防御模型对该样本进行预测，并根据识别结果计算相应的扰动量，$D(I, I^a)$。具体距离度量公式如下:<script type="math/tex; mode=display">D(I, I^a) = \begin{cases} 64 && M(I^a) = y \\ mean(\Vert I - I^a \Vert_2) && M(I^2) \neq y \end{cases}\tag 1</script>其中 $M$ 表示防御模型，$y$ 表示样本 $I$ 的真实标签。如果防御算法对样本识别正确，此次攻击不成功，扰动量直接置为上限 64。如果攻击成功，计算对抗样本 $I^a$ 和原始样本 $I$ 的扰动量，采用平均 $L_2$ 距离。每个对抗样本都会在 5 个防御模型上计算扰动量，最后对所有的扰动量进行平均，作为本次攻击的得分，得分越小越好。具体计算公式如下：<script type="math/tex; mode=display">Score(A) = \frac{1}{5n} \sum_{i=1}^{5} \sum_{j=1}^{n} D_i(I_j, I_j^a)\tag 2</script>其中 $n$ 为评测的样本数量。</li>
</ul>
</li>
<li>目标攻击:<ul>
<li>目标攻击比无目标攻击更加困难，不仅需要使模型识别错误，还需要使模型识别到指定的类别，同时扰动越小越好。</li>
<li>评估方法:<br>和无目标攻击一样，对每个生成的对抗样本，会采用 5 个基础防御模型对该样本进行预测。扰动量的计算方式和无目标攻击类似。在无目标攻击中，防御模型的输出是和真实类别 $y$ 进行比较，判断是否攻击成功。在目标攻击中，防御模型的输出是与指定攻击类别 $y^t$ 进行比较判断是否攻击成功。<script type="math/tex; mode=display">D(I, I^a) = \begin{cases} mean(\Vert I - I^a \Vert_2) && M(I^a) = y^t \\ 64 M(I^a) \neq y_t  \end{cases} \tag 3</script>和无目标攻击一样，目标攻击也使用平均扰动量作为最终的得分。得分越小越好。<script type="math/tex; mode=display">Score(A) = \frac{1}{5n} \sum_{i=1}^5 \sum_{j=1}^n D_i(I_j, I_j^a)\tag 4</script></li>
</ul>
</li>
<li>模型防御:<ul>
<li>选手需要提供更加鲁棒的防御模型，能够正确识别对抗样本，同时处理的扰动越大越好。</li>
<li>评估方法：<br>对于每个样本，使用 5 个攻击模型生成对抗样本去评估防御模型，如果防御模型识别错误，得分为 0。如果防御模型识别正确，计算扰动样本与原始样本之间的平均 $L_2$ 距离作为得分。得分越大越好。<script type="math/tex; mode=display">D(I, I^a) = \begin{cases} 0 && M(I^a) \neq y \\ mean(\Vert I - I^a \Vert_2) && M(I^a) = y \end{cases}\tag 5</script>防御模型的最终得分计算公式如下：<script type="math/tex; mode=display">Score(M) = \frac{1}{5n}\sum_{j=1}^{n} \sum_{i=1}^{5} D(I_j, A_I(I_j)) \tag 6</script>其中 $A_i(I_j)$ 表示第 $i$ 个攻击模型对 $I_j$ 生成的对抗样本.<br>需要注意的是，所有图片都会被resize到299X299进行评测。</li>
</ul>
</li>
</ol>
<h1 id="数据及提交格式"><a href="#数据及提交格式" class="headerlink" title="数据及提交格式"></a>数据及提交格式</h1><h2 id="数据"><a href="#数据" class="headerlink" title="数据"></a>数据</h2><ul>
<li>训练<br>  会提供 110 个类目 11 万左右的商品图片作为训练数据，这些商品图片来自阿里巴巴的电商平台。每个图片对应一个类目ID。另外，我们会提供一些基础分类模型供参赛选手使用。训练数据和基础分类模型会在近期开放下载。</li>
<li>评测<br>  在比赛的第一阶段，会使用 110 个图片和 <code>dev.csv</code>。<code>dev.csv</code>中包含了每个图片对应的真实类目 ID 和目标攻击的类目 ID（用于目标攻击），具体格式如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filename,trueLabel,targetedLabel</span><br><span class="line">0.png,0,43</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>另外，会使用 550 个图片作为第二阶段的评测数据，比赛的最终得分将在此数据上计算。</p>
<h2 id="提交格式"><a href="#提交格式" class="headerlink" title="提交格式"></a>提交格式</h2><p>参赛选手需要在阿里云的容器服务上<a href="https://cr.console.aliyun.com/构建一个Docker镜像，然后将Docker镜像的具体地址粘贴到提交框中进行提交。" target="_blank" rel="noopener">https://cr.console.aliyun.com/构建一个Docker镜像，然后将Docker镜像的具体地址粘贴到提交框中进行提交。</a></p>
<p><strong>限制:</strong></p>
<p>所有的提交镜像都会运行在Docker容器中（物理机的环境centos 7.2 and cuda8.0 ,driver 384.66）。由于资源有限，对提交镜像的大小和容器的运行时间有一些限制：</p>
<ul>
<li>Docker镜像大小限制:<br>  Docker镜像大小不能超过8GB。</li>
<li>运行时间限制:<br>  评测的时候，会使用GPU进行评测（1块P100卡），每次提交的运行时间限制在25分钟以内。</li>
<li>容器运行的过程中，网络是不可能用的。</li>
</ul>
<p><strong>Docker 镜像格式:</strong></p>
<p>Docker 镜像中必须包含一个 shell 脚本<code>run.sh</code>。 运行时的当前目录必须是<code>/competition</code>。</p>
<ul>
<li><p>无目标攻击与目标攻击<br>  <code>run.sh</code>用于生成对抗样本，输入参数是<code>${INPUT_DIR}</code>和<code>${OUTPUT_DIR}</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./run.sh <span class="variable">$&#123;INPUT_DIR&#125;</span>  <span class="variable">$&#123;OUTPUT_DIR&#125;</span></span><br></pre></td></tr></table></figure>
<p>  在评测过程中，<code>${INPUT_DIR}</code>会被映射到输入数据的路径，<code>${OUTPUT_DIR}</code>会被映射到对抗样本的路径。会用以下的方式来调用参赛选手提供的镜像：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nvidia-docker run \</span><br><span class="line">	-v <span class="variable">$&#123;INPUT_DIR&#125;</span>:/input_images \</span><br><span class="line">	-v <span class="variable">$&#123;OUTPUT_DIR&#125;</span>:/output_images \</span><br><span class="line">	-w /competition \</span><br><span class="line">	<span class="variable">$&#123;DOCKER_IMAGE_NAME&#125;</span> \</span><br><span class="line">	sh ./run.sh \</span><br><span class="line">	/input_images \</span><br><span class="line">	/output_images</span><br></pre></td></tr></table></figure>
</li>
<li><p>模型防御<br>  在模型防御任务中，<code>run.sh</code>用于预测对抗样本的类别。输入参数和输出分别是<code>${INPUT_DIR}</code>和<code>${OUTPUT_FILE}</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./run.sh $&#123;INPUT_DIR&#125; $&#123;OUTPUT_FILE&#125;</span><br></pre></td></tr></table></figure>
<p>  <code>${OUTPUT_FILE}</code>的输出格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">57.png,57</span><br><span class="line">50.png,50</span><br><span class="line">41.png,62</span><br><span class="line">55.png,55</span><br><span class="line">30.png,30</span><br><span class="line">6.png,6</span><br><span class="line">58.png,58</span><br></pre></td></tr></table></figure>
<p>  第一列是文件名，第二列是模型输出的 label.<br>  会采用以下的方式来运行参赛选手提供的镜像：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nvidia-docker run \</span><br><span class="line">	-v <span class="variable">$&#123;INPUT_DIR&#125;</span>:/input_images \</span><br><span class="line">	-v <span class="variable">$&#123;OUTPUT_DIR&#125;</span>:/output_data \</span><br><span class="line">	-w /competition \</span><br><span class="line">	<span class="variable">$&#123;DOCKER_IMAGE_NAME&#125;</span> \</span><br><span class="line">	sh ./run.sh \</span><br><span class="line">	/input_images \</span><br><span class="line">	/output_data/result.csv</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="无目标攻击参赛方案"><a href="#无目标攻击参赛方案" class="headerlink" title="无目标攻击参赛方案"></a>无目标攻击参赛方案</h1><h2 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h2><p>baseline 方法, 基于模型参数梯度的攻击方法, 这个方法的攻击条件就是要知道模型的结构和参数, 也就是所谓的白盒攻击. 攻击的时候首先将图片传到神经网络中, 计算相应的损失函数, 然后, 我们计算这个损失值相对于图片上每个像素点的梯度, 我们用这个梯度构造一个噪声, 将这个噪声的值添加到图片上相应位置以后, 会使得损失函数的值增大, 通过若干次的迭代后, 就能让该图片变成一个攻击样本, 使得网络对这张图片的类别分类错误.</p>
<p>两个重要性质:</p>
<ol>
<li>Transferability(可迁移性): 对于需要知道模型结构和参数取值的攻击方法, 我们称之为 “白盒攻击”. “白盒攻击” 在 “白盒” 条件(已知模型和参数)下通常具有很高的攻击成功率, 但是, 当它面对 “black-box setting” 时, 白盒攻击方法所产生的对抗样本往往表现很差, 尤其是在面对使用模型集成方法的防御模型时, 攻击成功率会降低到 10% 以下.</li>
<li>Robustness(鲁棒性): 实际上，基于梯度的方法所生成的对抗图像是脆弱的。通过实验，我们可以观察到，一旦对抗图像的完整性被破坏，攻击的成功率将大大降低。比如, ResNet 和 Inception 的放缩尺寸和归一化策略不同, 这使得在一个模型上攻击后的图像无法在另一个模型上保持鲁棒.</li>
</ol>
<p>从这两个角度出发, 我们提出了若干的优化方法来提升攻击图片的攻击效果</p>
<ul>
<li>Input Diversity (输入多样化)</li>
<li>Gaussian Blur(高斯模糊):<ul>
<li>Image Gaussian</li>
<li>Noise Gaussian</li>
</ul>
</li>
<li>central attack(中央攻击)</li>
<li>Cross Attack(交替攻击)</li>
</ul>
<p>no_momentum</p>
<h2 id="输入多样化-Input-Diversity"><a href="#输入多样化-Input-Diversity" class="headerlink" title="输入多样化(Input Diversity)"></a>输入多样化(Input Diversity)</h2><p>现阶段, 不论是在图像分类任务, 还是目标检测, 实例分割等其他视觉任务, 数据增广技术对于最终的性能提升来说都是不可或缺的一步, 基于此, 2019 由 Johns Hopkins University 的一篇文章中提出了通过多样化的图片输入来增强生成的对抗样本的攻击能力. 由于不同的网络通常具有不大一样的预处理流程, 包括 resize, cropping, rotating 等等, 因此, 和传统的 FGSM 方法不同, 我们不是直接在原始图像上计算相应的噪声, 相反, 我们会在每一次的迭代过程中以一定的概率 p, 随机的对图片进行缩放, 剪裁, 填充等等操作. 通过这种类似于数据增广式的处理之后, 可以使得我们生成的对抗图片本身具有泛化性更好的噪声, 进而可以提高在 “黑盒攻击设定” 下的成功率.</p>
<h2 id="降噪攻击-Denoised-Attack"><a href="#降噪攻击-Denoised-Attack" class="headerlink" title="降噪攻击(Denoised Attack)"></a>降噪攻击(Denoised Attack)</h2><p>图片在送入神经网络之前, 先经过一步降噪处理, 此时, 可以使得模型的防御能力提升. 为此, 我们提出了基于降噪处理的攻击方法, 生成可以对降噪图片起作用的攻击图片. 降噪处理方法有很多种, 如压缩, 高斯模糊等等. 下面我们以高斯模糊为例, 对其进行介绍. (其他类型的降噪方法理论上也可起到不同程度的强化攻击的作用)</p>
<h3 id="图像高斯"><a href="#图像高斯" class="headerlink" title="图像高斯"></a>图像高斯</h3><p>在进行模型防御任务时, 我们发现, 当对原始图片执行高斯模糊之后, 可以降低防御模型的准确率, 我们对大量的模型结构都进行了相同的实验, 发现这种准确率的降低是普遍存在的. 因此, 我们认为高斯模糊可以通过弱化图片的显著特征, 来使得神经网络无法根据这些特征正确判别物体的类别.<br>因此, 我们提出在每一次的迭代过程中, 都对当前的输入图像执行相应的高斯模糊操作, 我们这么做的好处有两点, 第一, 经过高斯模糊后的图片, 本身以及具有一定的攻击性, 它可以在一定程度上使得网络分类错误; 第二, 我们在高斯模糊后的图片上计算相应的 loss 函数值, 然后求取该 loss 相对于原始图像 x 的梯度, 并根据该梯度计算相应的 noise, 此时的 noise 相当于进一步是在误导性更强的图片上计算得到的, 因此, 在相应的扰动量约束下, 这种方式获得的 noise 具有更强的攻击能力.</p>
<h3 id="噪声高斯"><a href="#噪声高斯" class="headerlink" title="噪声高斯"></a>噪声高斯</h3><p>另一方面, 我们从 noise 角度出发, 通常我们会将生成的 noise 进行归一化处理后加到原始的图片中. 而我们在这里同时还会添加对 noise 的高斯模糊, 由于基于梯度的攻击方法是 “白盒攻击” 中的一类, 因此它产生的噪声非常依赖于模型的结构和参数, 而经过高斯模糊以后的 noise, 它原先的显著特征会趋于平滑, 使得 noise 对于单个模型的依赖性更小, 结合我们后面提出的交替攻击方法, 就可以使 noise 对于更大范围内的模型都普遍具有较强的攻击性.</p>
<h2 id="中央攻击-Central-Attack"><a href="#中央攻击-Central-Attack" class="headerlink" title="中央攻击(Central Attack)"></a>中央攻击(Central Attack)</h2><h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><p>该项改进的灵感来自于人类平常看待物体的方式, 通常, 对于任何一个物体, 我们第一眼总是会去关注这个物体的中心部分, 而对于边缘部分来说, 则关注度较少. 基于这个先验假设，我们提出了一种中央攻击方法，其核心思想就是在每一次的迭代中我们只保留 noise 的中央部分, 并将其添加到原始图像上. 简单来说, 采用中央攻击方法具有两点好处</p>
<ol>
<li>可以有效的减少对抗样本的扰动量。通过使用中央攻击, 我们可以在确保攻击成功的前提下，大幅度减少扰动量的大小。这是因为对于图像边缘来说, 我们的中央攻击方法可以令它的扰动量始终保持在 0 这一水平. 而对于最终的扰动量大小, 我们可以通过调节中央攻击区域的大小灵活的控制. 一般来说, 中央攻击区域的面积越小, 其所产生的扰动量就越小, 但是另一方面, 如果区域过于小的话, 就会造成攻击失败的情况。</li>
<li>可以增加对抗样本对 Image Crops 预处理的鲁棒性。 在神经网络中，我们通常使用一系列图像增强方法来处理图像，其中 five crops 和 center crop 都是非常常用的方法. 在进行模型防御任务时, 我们发现, 当我们将对抗样本按照 five crop 或者 center crop, 或者其他的剪裁方式进行剪裁以后, 这个对抗样本的攻击成功率就会大打折扣. 因此我们推测, 基于 FGSM 方法生成的对抗样本中, 其每一个像素点上的 noise 并不是完全独立的, 它们之间可能存在某种关系来共同支持对抗样本的攻击性. <strong>所以说当我们执行 crop 操作时, 实际上我们破坏了对抗图像上 noise 的完整性, 这样就会使得攻击的成功率急剧下降.</strong> 而当我们使用了中央攻击以后, 图像中中央区域就会产生一个完整的噪声, 此时虽然对于包含边缘部分的 crops 来说, 仍然破坏了对抗图像的完整性, 但是对于 center corp 以及 random crops 来说, 在大部分情况下, 都可以保证一定程度的完整性, 因此它具有抵御防御模型的裁剪操作的作用。</li>
</ol>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>一般来说, 在使用中央攻击的时候, 我们通常分成以下两步:</p>
<ol>
<li>当我们获得了一个很强的 baseline 分数时, 我们可以直接对其执行 central attack, 根据我们实验显示, 这样做了以后, 几乎总是能够获得更好的结果, 具体的提升幅度则取决于如何权衡中央攻击区域的大小.</li>
<li>当我们以及利用第一步 central attack 获得一个更好的分数时, 由于在一定程度上, 模型的攻击成功率和图像的扰动量是呈正相关的, 根据这一点我们可以逐渐放宽对于扰动量的限制, 进而使得模型的攻击成功率更高. 这是因为, 在经过第一步的 central attack 之后, 我们产生的图像 <strong>不仅分数更好, 同时扰动量也更低!</strong> 因此, 为了进一步获得更好的分数, 我们可以通过增加扰动量来提升模型的攻击成功率, 这样, 我们就可以在扰动量不超过最初对抗样本扰动量的前提下, 获得更高的攻击成功率. 需要注意的是, 这一步带来的提升是不稳定的, 也就是说它不能保证一定会获得更好的分数, 有时也会变得更差, 这是因为我们无法保证提升扰动量一定可以增加攻击成功率.</li>
</ol>
<h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p>基于显著特征的攻击方法.<br>中央攻击的方法虽然实现简单并且卓有成效, 但是它其实可以更进行更多的扩版, 例如, 我们并非只攻击中间部分, 而是将根据模型损失求得的梯度, 选择性的值更新那些响应最大的区域, 我们可以统计图像上的每一个像素的 noise 值, 并且选择 top-k 个像素点, 然后以这 k 个像素点为中心, 以一定的尺寸为半径, 只对这一部分区域进行更新. 又或者, 我们可以结合传统的边缘检测算子, 只对纹理特征明显的部分进行更新. 通过这些扩展, 我们认为在理论上可以进一步提高生成的对抗图像的攻击成功率.</p>
<h2 id="交替攻击-Cross-Attack"><a href="#交替攻击-Cross-Attack" class="headerlink" title="交替攻击(Cross Attack)"></a>交替攻击(Cross Attack)</h2><p>由于我们采用的是基于 FGSM 的 “白盒攻击” 方法</p>
<p>通常情况下, 为了获得更广泛的迁移能力和更强的鲁棒性, 我们通常会选择是模型集成方法来增强对抗样本的攻击成功率. 对于基于 FGSM 的方法来说, 在进行模型集成的时候, 通常会在每一次的迭代过程中, 同时计算多个模型的预测结果, 然后会基于一定的集成策略, 来计算最终的集成 noise. 常用的集成策略可以基于 logits, 或者基于 predictions, 或者基于最终 loss 等等. 不论是哪一种集成策略, 我们都需要将相应的模型加载到显存中并执行计算. 通常来说, 当集成的模型数量和种类越多时, 产生的对抗样本的迁移性和鲁棒性就越好, 但是由于有限的计算资源和时间限制, 我们往往无法集成太多的模型. 故此, 我们提出了一种交替攻击的对抗样本生成方法. 具体来说, 就是在每一次的迭代过程中, 我们都攻击不同的模型, 这样, 我们就可以在相同的时间限制和资源限制下, 尽可能的使对抗样本对于更多的模型都具体攻击性. 举个例子, 假设我们现在有 ABC 三个模型, 由于资源和时间的限制, 我们在每次迭代中最多同时攻击这三个模型并计算集成后的 noise. 当我们通过模型防御赛道获得了一些效果很不错的模型时, 假设获取到了 6 个表现不错的模型, 将其记为 D, E, F, H, I, J.(为了简单起见, 我们假设A~J模型的大小均相同) 此时我们希望对这 6 个模型也进行攻击, 那么我们通常的做法是直接用这 6 个模型来替换 ABC 中的模型. 但是这样实际上仍然无法获得更鲁棒的对抗样本.<br>因此, 我们提出, 将 A~J 这 9 个模型随机分成三组, 每一组包含三个模型, 然后依次执行三次迭代, 每一次迭代的输出仍然和传统方法一样会作为下一次迭代的输入, 这样, 经过三次迭代以后, 我们的对抗样本就会带有对这 9 个模型都有效的 noise. 然后, 我们再重新的随机分组, 执行相同的逻辑. 这样一来, 我们可以在使用了相同的显存资源和运行时间的前提下, 生成攻击范围更广的对抗样本. 在实际使用中, 由于各个模型之间的大小差异比较大, 因此在进行分组的时候, 无法完全随机, 但是即使是人工设定的分组方案, 也可以在相同条件下, 获得更好的分数. 根据我们的实验效果, 我们认为这种提升是稳定的, 并且可以和其他方法想兼容, 就是说当我们获得了一个较好的分数时, 我们往往可以利用这种方法, 获得一个更好的分数.</p>
<h2 id="模型集成"><a href="#模型集成" class="headerlink" title="模型集成"></a>模型集成</h2><h3 id="Preprocessing-Unified-Ensembling"><a href="#Preprocessing-Unified-Ensembling" class="headerlink" title="Preprocessing Unified Ensembling"></a>Preprocessing Unified Ensembling</h3><p>使用基于 FGSM 的方法在进行模型集成的时候, 我们需要就同样的 input x 作为输入, 输送到不同的网络中去, 然后计算相应的 logits 和集成后的 loss, 进而求得关于 input x 的梯度, 然后利用这个梯度计算相应的 noise. 需要注意的是 noise 和 input x 的 shape 是完全相同的, 因此, 当集成不同的模型时, 如果他们的输入具有不同的尺寸, 那么就会有多个不同 shape 的 input x. 但是 noise 却只有一个, 在这种情况下, 我们无法令对抗样本更新, 也无法执行有效的模型集成工作. 除此此外, 不同的模型参与的归一化方法也不同, 有的模型会将图像的像素值归一化到 [0, 1] 之间, 而有的则会归一化到 [-1, 1] 之间.<br>对于这种情况, 我们普遍的做法是将计算得到的 noise 分别 resize 到不同的尺寸上, 同时将其值转化都不同的区间上, 以此来匹配 input x 的 shape. 但是经过实验我们发现, 这种集成方式会大大破坏 noise 的整体性, 从而使得攻击效果大幅降低.</p>
<p>为了解决上述问题，我们提出了一种通用的模型集成方法, 使其可以利用图像预处理操作（调整大小，标准化等）可微分的性质的。 具体来说, 与将调整大小和标准化作为预处理操作的传统 pipeline 不同, 我们会将图像的预处理操作放入 pytocrh（或 tensorflow 等）计算图中，这样我们就可以直接沿着反向传播的方向求出原始图像上的扰动, 通过这样一个简单的操作, 我们可以最大程度地确保所产生的扰动的完整性，从而显著提高了集成模型的有效性。</p>
<p>通过这种方法, 我们消除了对模型预处理操作的约束, 使得我们可以对每一个模型进行针对性的预处理操作, 尽量的提升单个模型的性能, 这样一来, 在模型集成的时候, 就可以获得更加鲁棒的对抗样本结果.</p>
<h3 id="集成策略"><a href="#集成策略" class="headerlink" title="集成策略"></a>集成策略</h3><p>在进行模型继承的时候, 我们尝试了多种不同的集成策略, 总的来说有三种, 第一种是按照 softmax 激活函数的输出进行集成, 第二种是按照模型的预测结果进行集成, 第三种是按照每个模型的 loss 进行集成.</p>
<p>这三种集成方法的区别在于选取的模型输出位置的不同, 因为我们的 loss 是通过 predictions 计算来的, 而 predictions 又是通过 logits 计算来. 通过大量的实验我们发现, 在 logits 处进行集成可以在无目标攻击任务上获得最好的分数.<br>原因: 对于无目标攻击来说, 我们只需要模型出错即可, 不要求它必须在哪一类出错, 因此, 相对于集成 loss 和 predictions, 集成 logits 更加直接, 当 logits 发生一定程度的变化时, 自然就会使得最终的 loss 升高, 进而让模型预测错误.</p>
<h3 id="模型权重"><a href="#模型权重" class="headerlink" title="模型权重"></a>模型权重</h3><p>在进行模型集成的时候, 我们发现, 并不是每一个模型的重要性都是相同的, 根据我们的实验结果, 我们认为用于生成对抗图像的模型的重要性可以通过在集成多个模型时的平均权重设置来反映。 因此我们会尝试不同模型的类型，并增加相应模型的权重。 这一步的提升是不稳定的, 我们不能保证权重的修改一定能带来多少提升. 需要根据具体的场景做修改.</p>
<p>将高斯模糊和中心剪裁应用在基于图像和梯度产生的噪声矩阵当中, 可以在一定程度上提高对抗样本的可迁移性.</p>
<p>除此之外, 我们还提出了一个统一的模型继承方法, 使得我们可以将预处理流程不同的多个模型集成到一起. 从而大大提高对抗图片的攻击范围.</p>
<p>一些研究表明，使用基于梯度算法生成的对抗图像可以很容易地愚弄神经网络。但是，当攻击者处于黑匣子设置或者对抗图像的完整性受到损害时，攻击成功概率将大大降低。在本文中，我们探索高斯模糊和中心裁剪方法，有助于生成对抗图像，这些图像更强大，具有更好的传递能力。大量关于IJCAI-2019阿里巴巴对抗性人工智能挑战（AAAC 2019）的实验表明，我们提出的调整产生的对抗图像在黑盒设置下也具有更好的性能，并且对于具有防御措施的模型更具鲁棒性。此外，我们还提出了一种新颖有效的模型集成方法，称为预处理统一集成（PUE），它可以在不同的图像尺寸和不同的预处理模型上集成模型。结合提出的方法和PUE，AAAC 2019的在线分数在非目标对抗性攻击中排名第3，在目标对抗性攻击中排名第8。</p>
<p>神经网络广泛用于各种任务并实现高精度。 然而，研究表明，CNN网络容易受到对抗性图像的影响[Szegedy等，2014，Goodfellow等人，2015]，这使得CNN网络在一些具有高安全性要求的应用场景中面临着巨大的威胁。 对抗图像意味着通过某些方法将噪声添加到原始图像。 这些噪声可能不容易被人类检测到，但它们经常导致神经网络中非常错误的错误。 例如，[Brown et al.2017]提出，他们可以通过在图片上添加贴纸来混淆神经网络，以便神经网络将任何图像识别为烤面包机，[Thys et al.2019]提出打印 a4纸的图像可以使人在物体检测系统中不可见。 这些研究表明，尽管神经网络功能强大，但在面对精心设计的对抗图像时它非常脆弱。</p>
<h2 id="实验效果"><a href="#实验效果" class="headerlink" title="实验效果"></a>实验效果</h2><p><div style="width: 500px; margin: auto"><img src="http://zerozone-blog.oss-cn-beijing.aliyuncs.com/CompetitionIJCAI/attack_tab1.jpg?x-oss-process=style/blog_img" alt="CompetitionIJCAI%2Fattack_tab1.jpg"></div></p>
<p><div style="width: 500px; margin: auto"><img src="http://zerozone-blog.oss-cn-beijing.aliyuncs.com/CompetitionIJCAI/attack_fig1.jpg?x-oss-process=style/blog_img" alt="CompetitionIJCAI%2Fattack_fig1.jpg"></div></p>
<p><div style="width: 500px; margin: auto"><img src="http://zerozone-blog.oss-cn-beijing.aliyuncs.com/CompetitionIJCAI/attack_fig2.jpg?x-oss-process=style/blog_img" alt="CompetitionIJCAI%2Fattack_fig2.jpg"></div></p>
<h1 id="目标攻击参赛方案"><a href="#目标攻击参赛方案" class="headerlink" title="目标攻击参赛方案"></a>目标攻击参赛方案</h1><h2 id="区别一"><a href="#区别一" class="headerlink" title="区别一"></a>区别一</h2><p>目标攻击和无目标攻击相差不多, 只不过目标攻击需要让模型将物体识别成指定的类别. 具体来说, 就是在更新 noise 的方式上有所不同, 下面分别是无目标攻击和目标攻击的 noise 更新代码.</p>
<p>无目标攻击:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cross_entropy = F.cross_entropy(logits, y)</span><br><span class="line">cross_entropy.backward()</span><br><span class="line">noise = x.grad</span><br><span class="line">noise = noise.cpu()</span><br><span class="line">x = x.cpu()</span><br><span class="line">noise = noise / torch.reshape(</span><br><span class="line">  torch.std(torch.reshape(noise, [args.batch_size, <span class="number">-1</span>]), dim=<span class="number">1</span>),</span><br><span class="line">  shape=[args.batch_size, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>])</span><br><span class="line">x = x + alpha * torch.clamp(torch.round(noise), <span class="number">-2</span>, <span class="number">2</span>)</span><br><span class="line">x = torch.min(x, x_max)</span><br><span class="line">x = torch.max(x, x_min)</span><br></pre></td></tr></table></figure></p>
<p>目标攻击:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cross_entropy_vgg = F.cross_entropy(logits_vgg, y)</span><br><span class="line">cross_entropy_vgg.backward()</span><br><span class="line">noise_vgg = processed_imgs_vgg.grad</span><br><span class="line">noise = (noise_inc1 + noise_den264 + noise_res + noise_vgg) / <span class="number">4.0</span></span><br><span class="line">noise = noise / torch.reshape(</span><br><span class="line">torch.std(torch.reshape(noise, [args.batch_size, <span class="number">-1</span>]), dim=<span class="number">1</span>),</span><br><span class="line">shape=[args.batch_size, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>])</span><br><span class="line">noise = momentum * grad + noise</span><br><span class="line">noise = noise / torch.reshape(</span><br><span class="line">torch.std(torch.reshape(noise, [args.batch_size, <span class="number">-1</span>]), dim=<span class="number">1</span>),</span><br><span class="line">shape=[args.batch_size, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>])</span><br><span class="line">grad = noise</span><br><span class="line">x = x - alpha * torch.clamp(torch.round(noise), <span class="number">-2</span>, <span class="number">2</span>)</span><br><span class="line">x = x.cpu()</span><br><span class="line">x = torch.min(x, x_max)</span><br><span class="line">x = torch.max(x, x_min)</span><br></pre></td></tr></table></figure></p>
<h2 id="区别二"><a href="#区别二" class="headerlink" title="区别二"></a>区别二</h2><p>目标攻击参赛方案和无目标攻击参赛方案的另外一处不同点在于模型的集成方法不同, 对于无目标攻击来说, 按照 logits 进行集成可以获得最佳的效果, 而对于目标攻击来说, 按照 loss 进行集成可以获得最佳的效果. 这是因, 对于目标攻击来说, 我们需要将物体识别成特定的物体时才能算是攻击成功, 因此, 对于 logits 的变化, 如果它不能将物体特定类别的预测概率提高, 那么他就不应该产生相应的 loss, 所以, 当我们使用目标攻击时, 直接按照 loss 进行融合, 可以获得更可观的性能提升.</p>
<h1 id="模型防御参赛方案"><a href="#模型防御参赛方案" class="headerlink" title="模型防御参赛方案"></a>模型防御参赛方案</h1><h2 id="简述-1"><a href="#简述-1" class="headerlink" title="简述"></a>简述</h2><p>目前我们已经知道, 神经网络很容易就会受到对抗样本的攻击，这对于处在安全敏感系统中的应用来说是一个潜在的威胁。 我们可以通过逐层累积对抗性的噪声来使得模型产生错误的分类。基于这一点, 我们提出了将映射函数变换（mapping function transforms, MFT）作为针对图像分类任务的防御策略。 MFT 的核心思想就将原始图像和对抗图像分别映射到其他的图像空间, 我们的目的就是要找到可以完成这一任务的函数 $f$, 进而解决神经网络容易受到对抗样本攻击的问题。在这个新的图像空间中，原始图像和对抗图像之间的 $L_2$ 范数将会变得更小，从而让模型在面对具有较大扰动的图像时, 依然能够保持较强的分类能力。MFT 有两个优点:</p>
<ol>
<li>MFT 可以使目标模型对白盒和黑盒对抗性攻击更加健壮。</li>
<li>MFT 可以非常容易地扩展到大型数据集，并且在 Inference 阶段也只花费很少的时间。</li>
</ol>
<p><div style="width: 500px; margin: auto"><img src="http://zerozone-blog.oss-cn-beijing.aliyuncs.com/CompetitionIJCAI/fig1.jpg?x-oss-process=style/blog_img" alt="CompetitionIJCAI%2Ffig1.jpg"></div></p>
<p>目前神经网络已经广泛用于各种任务, 并且能够在大多数任务中达到较高的精度。 但是，神经网络很容易受到对抗样本的影响。 对抗样本是指通过向原始图像添加一下细微小扰动而获得的图像。并且在更新的研究结果和技术的加持下, 对抗样本可以在不同模型之间保持迁移性。 这种迁移性能够在不知道目标模型的权重和结构的情况下实现黑盒对抗性攻击。 黑盒攻击在现实世界的场景中已被证明是可行的，它对一些安全敏感的深度学习应用程序（如身份验证和自动驾驶）会构成巨大的潜在威胁。 因此，找到有效的防御对抗性攻击的方法就显得尤为重要。</p>
<h2 id="传统方法"><a href="#传统方法" class="headerlink" title="传统方法"></a>传统方法</h2><p>传统的去噪方法是找到一个去噪函数 $f$，其目标是使得距离 $\Vert x - f(x_{adv})\Vert$ 尽可能的小, 这样一来它就可以在一定程度上减少对抗样本的干扰，进而提高神经网络处理对抗图像的能力(如下面的图2所示)。 但是, 通过大量实验, 我们发现传统的去噪方法对减小距离 $\Vert x - f(x_{adv}) \Vert$ 的能力有限。</p>
<p><div style="width: 500px; margin: auto"><img src="http://zerozone-blog.oss-cn-beijing.aliyuncs.com/CompetitionIJCAI/fig2.jpg?x-oss-process=style/blog_img" alt="CompetitionIJCAI%2Ffig2.jpg"></div></p>
<h2 id="MFT-Operation"><a href="#MFT-Operation" class="headerlink" title="MFT Operation"></a>MFT Operation</h2><p>为了进一步提高神经网络处理具有更大扰动的对抗样本的能力，我们提出了映射函数变换（mapping function transforms, MFT）。我们发现我们可以找到一个映射函数 $f$，来使得距离 $\Vert f(x) -  f(x_{adv}) \Vert$ 尽可能小，而不是传统方法中的减小距离 $\Vert x - f(x_{adv}) \Vert$. 通过这种函数变换, 我们希望在另一个空间中建立原始图像和对抗图像之间的相互关系。映射函数 $f$ 可以是传统的去噪方法，也可以是通过神经网络学习的。在进行比赛的时候, 我们使用的是传统的去燥方法, 因为这样实现起来相当容易, 并且在效果上也很不错, 可以大幅降低扰动带来的影响, 进而显著提高模型的防御能力, 如图3所示.</p>
<p><div style="width: 500px; margin: auto"><img src="http://zerozone-blog.oss-cn-beijing.aliyuncs.com/CompetitionIJCAI/fig3.jpg?x-oss-process=style/blog_img" alt="CompetitionIJCAI%2Ffig3.jpg"></div></p>
<h2 id="使用-MFT-进行训练和预测"><a href="#使用-MFT-进行训练和预测" class="headerlink" title="使用 MFT 进行训练和预测"></a>使用 MFT 进行训练和预测</h2><p>MFT可以显着减少扰动，这比传统的去噪方法更好。但是MFT可能会导致图像质量下降，同时还会使得神经网络的输入出现不一致的现象. 为了解决这个问题，我们选择在 MFT 图像上训练神经网络而不是原始图像。在 Inference 阶段，我们还会将 MFT 图像馈送到神经网络中, 进而获得预测结果。</p>
<h2 id="MFT-Operations"><a href="#MFT-Operations" class="headerlink" title="MFT Operations"></a>MFT Operations</h2><p>我们尝试了许多不同的函数作为我们的 MFT operations, 最有效果的为以下两种:</p>
<ul>
<li>Gaussian Filter: 高斯滤波器是一种广泛用于图像处理降噪处理的线性平滑滤波器。 它用来自附近像素的强度值的加权平均值替换每个像素的强度。<script type="math/tex; mode=display">y_i = \frac{1}{C(x)} \sum_{\forall j \in \Omega (i)} f(x_i, x_j) \cdot x_j \tag 3</script>上式中的权重 $f(x_i, x_j)$ 是基于 Gaussian distribution 的, 并且其值并不仅仅取决于像素的欧几里德距离. $C(x)$ 是归一化函数</li>
<li>Biateral Filter: 双边滤波器，它是一个用于图像的非线性滤波器，具有边缘保持和降噪平滑等特点。 它用来自附近像素的强度值的加权平均值替换每个像素的强度。从形式上来看，它的定义如下：<script type="math/tex; mode=display">y_i = \frac{1}{C(x)} \sum_{\forall j \in \Omega (i)} f(x_i, x_j) \cdot x_j\tag 4</script>上式中权重 $f(x_i, x_j)$ 可以基于高斯分布。需要注意，其权重也不仅仅取决于像素的欧几里德距离，还取决于辐射度差异（例如颜色强度，深度距离等）, 同样, 分式中的 $C(x)$ 也是归一化函数。</li>
</ul>
<p>我们使用训练好的模型, 从验证集中随机挑选了 1000 张图片, 分别进行了两组实验来验证 MFT Operations 的有效性.</p>
<h3 id="Vanilla-Attack-Scenario"><a href="#Vanilla-Attack-Scenario" class="headerlink" title="Vanilla Attack Scenario"></a>Vanilla Attack Scenario</h3><p>Vanilla Attack 攻击者不知道 MFT 操作的存在，也就说说攻击者不会专门针对 MFT 操作进行攻击.</p>
<p>对于 vanilla attack scenario，我们使用 $sigma = 5$ 的高斯滤波器作为 MFT 操作，由于攻击者不知道 $MFT$ 操作，因此它会直接使用原始网络作为目标模型来生成对抗样本。 从表1中列出的 top-1 精度可以看出，MFT 操作可以显著提升单步和迭代攻击生成的具有较大扰动的对抗图片的识别准确率。 对于单步攻击 $FGSM-\epsilon$，较大的 $\epsilon$ 表示较强的可迁移性，因此更难以防御。 但是，使用 Inception-ResNet-v2（99.54％ 的 top-1 精度），我们仍然可以在单步攻击（即使是较大的 $\epsilon$）上获得令人满意的防御模型准确度。 对于迭代攻击，攻击者总是在目标模型上达到非常高的攻击率，但在面对应用 MFT 操作后的模型几乎无法攻击成功。 这是因为迭代攻击方法会过度拟合到目标模型，因此具有较弱的可转移性。</p>
<p><div style="width: 500px; margin: auto"><img src="http://zerozone-blog.oss-cn-beijing.aliyuncs.com/CompetitionIJCAI/tab1.jpg?x-oss-process=style/blog_img" alt="CompetitionIJCAI%2Ftab1.jpg"></div></p>
<h3 id="Un-vanilla-Attack-Scenario"><a href="#Un-vanilla-Attack-Scenario" class="headerlink" title="Un-vanilla Attack Scenario"></a>Un-vanilla Attack Scenario</h3><p>Un-vanilla Attack 代表攻击者知道 MFT 操作的存在。</p>
<p>对于 Un-vanilla attack scenario，我们使用 $sigma = 5$ 的高斯滤波器作为 $MFT$ 操作，并且攻击者知道 $MFT$ 操作的存在, 也就是说在攻击之前会先对图片进行 MFT 操作, 使之在攻击时, 可以针对 MFT 进行攻击。表2显示了目标模型和防御模型的 top-1 精度，可以看出, 虽然结果比 vanilla attack scenario 更差一些(这是意料之中的)，但是仍然具有比目标模型更好的结果，这也意味着 MFT 操作可以普遍的提高对抗样本的 top-1 准确度。</p>
<p><div style="width: 500px; margin: auto"><img src="http://zerozone-blog.oss-cn-beijing.aliyuncs.com/CompetitionIJCAI/tab2.jpg?x-oss-process=style/blog_img" alt="CompetitionIJCAI%2Ftab2.jpg"></div></p>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/计算机视觉/" rel="tag"><i class="fa fa-tag"></i> 计算机视觉</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/z_post/计算机视觉-EfficientNet-ICML2019/" rel="next" title="EfficientNet (ICML, 2019)">
                EfficientNet (ICML, 2019) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar_zz.png"
                alt="ZeroZone" />
            
              <p class="site-author-name" itemprop="name">ZeroZone</p>
              <p class="site-description motion-element" itemprop="description">吾乃闪耀的芝士蛋挞!</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">268</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">13</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">41</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/hellozhaozheng" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:hellozhaozheng@foxmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://blog.csdn.net/ksws0292756" title="零域CSDN博客" target="_blank">零域CSDN博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://xinghanzzy.github.io/" title="BoXiao的博客" target="_blank">BoXiao的博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://oldpan.me/" title="Oldpan的博客" target="_blank">Oldpan的博客</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#赛题介绍及获得名次"><span class="nav-text">赛题介绍及获得名次</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#任务目标及评测标准"><span class="nav-text">任务目标及评测标准</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数据及提交格式"><span class="nav-text">数据及提交格式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#数据"><span class="nav-text">数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#提交格式"><span class="nav-text">提交格式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#无目标攻击参赛方案"><span class="nav-text">无目标攻击参赛方案</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#简述"><span class="nav-text">简述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输入多样化-Input-Diversity"><span class="nav-text">输入多样化(Input Diversity)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#降噪攻击-Denoised-Attack"><span class="nav-text">降噪攻击(Denoised Attack)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#图像高斯"><span class="nav-text">图像高斯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#噪声高斯"><span class="nav-text">噪声高斯</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#中央攻击-Central-Attack"><span class="nav-text">中央攻击(Central Attack)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#优势"><span class="nav-text">优势</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用"><span class="nav-text">使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#扩展"><span class="nav-text">扩展</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#交替攻击-Cross-Attack"><span class="nav-text">交替攻击(Cross Attack)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模型集成"><span class="nav-text">模型集成</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Preprocessing-Unified-Ensembling"><span class="nav-text">Preprocessing Unified Ensembling</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#集成策略"><span class="nav-text">集成策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模型权重"><span class="nav-text">模型权重</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实验效果"><span class="nav-text">实验效果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#目标攻击参赛方案"><span class="nav-text">目标攻击参赛方案</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#区别一"><span class="nav-text">区别一</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#区别二"><span class="nav-text">区别二</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#模型防御参赛方案"><span class="nav-text">模型防御参赛方案</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#简述-1"><span class="nav-text">简述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#传统方法"><span class="nav-text">传统方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MFT-Operation"><span class="nav-text">MFT Operation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-MFT-进行训练和预测"><span class="nav-text">使用 MFT 进行训练和预测</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MFT-Operations"><span class="nav-text">MFT Operations</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Vanilla-Attack-Scenario"><span class="nav-text">Vanilla Attack Scenario</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Un-vanilla-Attack-Scenario"><span class="nav-text">Un-vanilla Attack Scenario</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ZeroZone</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="站点总字数">2.7m</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="站点阅读时长">40:38</span>
  
</div>










  <div class="footer-custom">勤练带来力量</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="总访客量">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="总访问量">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  















  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.3.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.3.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.3.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



  





  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'manual') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>





  
  

  
  

  
    
      <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      TeX: {equationNumbers: { autoNumber: "AMS" }}
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    
  


  
  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap')
      $(e).after($wrap)
      $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text()
        }).toArray().join('\n')
        var ta = document.createElement('textarea')
        document.body.appendChild(ta)
        ta.style.position = 'absolute'
        ta.style.top = '0px'
        ta.style.left = '0px'
        ta.value = code
        ta.select()
        ta.focus()
        var result = document.execCommand('copy')
        document.body.removeChild(ta)
        
        $(this).blur()
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn')
        setTimeout(function () {
          $b.text('复制')
        }, 300)
      }).append(e)
    })
  </script>


</body>
</html>
